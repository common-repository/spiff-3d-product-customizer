!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r,o=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},i=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},a=function(){var t=this;this.getCreateTransactionResponse=function(e){return o(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t={query:this.createTransactionRequestBody(e)},[4,fetch(S.API+"/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:if(403===(n=r.sent()).status)throw new Error("Could not make transaction. Check that you have an active plan.");return[4,n.json()];case 2:return[2,r.sent().data.transactionCreate]}}))}))},this.getExistingTransactionResponse=function(e){return o(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t={query:this.getTransactionRequestBody(e)},[4,fetch(S.API+"/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:if(403===(n=r.sent()).status)throw new Error("Could not make transaction. Check that you have an active plan.");return[4,n.json()];case 2:return[2,r.sent().data.transactions[0]]}}))}))},this.getIntegrationProductDetailsResponse=function(e){return o(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t={query:this.getIntegrationProductRequestBody(e)},[4,fetch(S.API+"/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:if(403===(n=r.sent()).status)throw new Error("Could not retrieve integration product. Check that you have an active plan.");return[4,n.json()];case 2:return[2,r.sent().data.integrationProducts[0]]}}))}))},this.getExternalProductDetailsResponse=function(e){return o(t,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t={query:this.getExternalProductRequestBody(e)},[4,fetch(S.API+"/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:if(403===(n=r.sent()).status)throw new Error("Could not retrieve integration product. Check that you have an active plan.");return[4,n.json()];case 2:return[2,r.sent().data.integrationProductFromExternalIds]}}))}))},this.getTransactionRequestBody=function(t){return'\n                query GetExistingTransaction {\n                    transactions(ids: ["'+t.transactionId+'"]) {\n                        id\n                        workflowViewerLink\n                    }\n                }\n            '},this.createTransactionRequestBody=function(t){if(t.integrationProductId)return'\n                mutation TransactionCreateFromIntegrationProductForEcom {\n                    transactionCreate(\n                        integrationProductId: "'+t.integrationProductId+'",\n                        bulk: '+t.bulk+",\n                        createDesignProduct: "+!!t.createDesignProduct+"\n                    ) {\n                        id\n                        designName\n                        bulk\n                        product {\n                            id\n                            basePrice\n                            enabled\n                            name\n                            partner {\n                                id\n                                name\n                                currencyCode\n                                customerDetailsPromptMarkdown\n                            }\n                            profanities {\n                                id\n                                word\n                            }\n                            sku\n                            weight\n                            workflows {\n                                id\n                                friendlyName\n                                isPresent\n                                workflowName\n                                imageUrl\n                            }\n                            imageUrl\n                            modelUrl\n                            overlayImageUrl\n                            preloadImageUrl\n                            promptForCustomerDetails\n                            bulkConfiguration {\n                                id\n                                name\n                                sceneTitle\n                                stepTitle\n                                helpText\n                                supportsGoogleSheet\n                                maxVariations\n                                pricingStrategy\n                            }\n                        }\n                        integrationProduct {\n                            id\n                        }\n                        transactionOwnerId\n                        workflowId\n                        customLogoLink\n                        workflowFooterLogoLink\n                        restApiIntegrationLink\n                        workflowViewerLink\n                        bulkSourceUrl\n                    }\n                }\n            ";if(t.externalIntegrationId&&t.externalProductId)return'\n                mutation TransactionCreateFromExternalIdsForEcom {\n                    transactionCreate(\n                        externalIntegrationId: "'+t.externalIntegrationId+'",\n                        externalProductId: "'+t.externalProductId+'",\n                        bulk: '+t.bulk+",\n                        createDesignProduct: "+!!t.createDesignProduct+"\n                    ) {\n                        id\n                        designName\n                        bulk\n                        product {\n                            id\n                            basePrice\n                            enabled\n                            name\n                            partner {\n                                id\n                                name\n                                currencyCode\n                                customerDetailsPromptMarkdown\n                            }\n                            profanities {\n                                id\n                                word\n                            }\n                            sku\n                            weight\n                            workflows {\n                                id\n                                friendlyName\n                                isPresent\n                                workflowName\n                                imageUrl\n                            }\n                            imageUrl\n                            modelUrl\n                            overlayImageUrl\n                            preloadImageUrl\n                            promptForCustomerDetails\n                            bulkConfiguration {\n                                id\n                                name\n                                sceneTitle\n                                stepTitle\n                                helpText\n                                supportsGoogleSheet\n                                maxVariations\n                                pricingStrategy\n                            }\n                        }\n                        integrationProduct {\n                            id\n                        }\n                        transactionOwnerId\n                        workflowId\n                        customLogoLink\n                        workflowFooterLogoLink\n                        restApiIntegrationLink\n                        workflowViewerLink\n                        bulkSourceUrl\n                    }\n                }\n            ";throw new Error("Invalid transaction creation request details.")},this.getIntegrationProductRequestBody=function(e){return'\n            query GetIntegrationProduct {\n                integrationProducts(ids: ["'+e.integrationProductId+'"]) {\n                    '+t.getIntegrationProductResultBody()+"\n                }\n            }\n        "},this.getExternalProductRequestBody=function(e){return'\n            query GetIntegrationProduct {\n                integrationProductFromExternalIds(\n                    externalIntegrationId: "'+e.externalIntegrationId+'",\n                    externalProductId: "'+e.externalProductId+'"\n                ) {\n                    '+t.getIntegrationProductResultBody()+"\n                }\n            }\n        "},this.getIntegrationProductResultBody=function(){return"\n            id\n            integration {\n                id\n                enabled\n            }\n            product {\n                id\n                enabled\n                workflows {\n                    workflowName\n                }\n            }\n        "}},s=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},c=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(t){t[t.Initial=0]="Initial",t[t.Confirming=1]="Confirming",t[t.Ready=2]="Ready",t[t.Invalid=3]="Invalid"}(r||(r={}));var u,l=function(){function t(){this.callbacks=[],this.state=r.Initial}return t.prototype.on=function(t,e){if("ready"!==t&&"invalid"!==t)throw new Error("Invalid callback event name: "+t+".");this.callbacks.push({eventName:t,callback:e.bind(this)})},t.prototype.confirmActive=function(){return s(this,void 0,void 0,(function(){var t;return c(this,(function(e){switch(e.label){case 0:return this.assertInitial(),this.state=r.Confirming,[4,this.checkProductIsActive()];case 1:return(t=e.sent())?(this.state=r.Ready,this.callbacks.forEach((function(t){"ready"===t.eventName&&t.callback({})}))):(this.state=r.Invalid,this.callbacks.forEach((function(t){"invalid"===t.eventName&&t.callback({})}))),[2,t]}}))}))},t.prototype.getIntegrationProduct=function(t){var e=this;return new Promise((function(n){if(e.integrationProduct)n(e.integrationProduct);else{var r=null!=t?t:new a;e.getIntegrationProductFromServer(r).then((function(t){return n(t)}))}}))},t.prototype.checkProductIsActive=function(){var t,e;return s(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return[4,this.getIntegrationProduct()];case 1:return n=r.sent(),(null===(t=null==n?void 0:n.product)||void 0===t?void 0:t.enabled)&&(null===(e=null==n?void 0:n.integration)||void 0===e?void 0:e.enabled)?[2,!0]:[2,!1]}}))}))},t}(),d=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=function(t){function e(e){var n=t.call(this)||this;return n.integrationProductId=e,n}return d(e,t),e.prototype.assertReady=function(){if(this.state===r.Initial)throw new Error("This integration product's validity has not been confirmed. Run the integration product's confirmActive() method.");if(this.state===r.Confirming)throw new Error("This integration product is in the process of confirming its validity. Wait for the promise to resolve.");if(this.state===r.Invalid)throw new Error("This integration product is not valid. Check the integration product ID is correct and that the product is enabled.")},e.prototype.assertInitial=function(){if(this.state===r.Confirming)throw new Error("Confirmation in progress. Wait for promise to resolve.");if(this.state===r.Ready)throw new Error("This product is already known to be active.");if(this.state===r.Invalid)throw new Error("This product is invalid. Check that the integration product ID is correct and that the product is enabled.")},e.prototype.getExperienceQueryParams=function(){return["integrationProductId="+this.integrationProductId]},e.prototype.transactionRequestDetails=function(t,e){return{integrationProductId:this.integrationProductId,callbackUrl:window.location.href,createDesignProduct:t,bulk:e}},e.prototype.getIntegrationProductFromServer=function(t){return t.getIntegrationProductDetailsResponse({integrationProductId:this.integrationProductId})},e}(l),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=function(t){function e(e){var n=t.call(this)||this;return n.options=e,n}return f(e,t),e.prototype.getExternalIntegrationId=function(){return this.options.integrationId},e.prototype.getExternalProductId=function(){return this.options.productId},e.prototype.getState=function(){return this.state},e.prototype.assertReady=function(){if(this.state===r.Initial)throw new Error("This product's validity has not been confirmed. Run the product's confirmActive() method.");if(this.state===r.Confirming)throw new Error("This product is in the process of confirming its validity. Wait for the promise to resolve.");if(this.state===r.Invalid)throw new Error("This product is not valid. Check the product and integration IDs are correct and that the product is enabled.")},e.prototype.assertInitial=function(){if(this.state===r.Confirming)throw new Error("Confirmation in progress. Wait for promise to resolve.");if(this.state===r.Ready)throw new Error("This product is already known to be active.");if(this.state===r.Invalid)throw new Error("This product is invalid. Check that the product and integration IDs are correct and that the product is enabled.")},e.prototype.getExperienceQueryParams=function(){return["externalIntegrationId="+this.options.integrationId,"externalProductId="+this.options.productId]},e.prototype.transactionRequestDetails=function(t,e){return{externalIntegrationId:this.options.integrationId,externalProductId:this.options.productId,callbackUrl:window.location.href,createDesignProduct:t,bulk:e}},e.prototype.getIntegrationProductFromServer=function(t){var e=this.options.integrationId.replace(/\//g,"_");return t.getExternalProductDetailsResponse({externalIntegrationId:e,externalProductId:this.options.productId})},e}(l),y=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},g=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},m=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},b=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(m(arguments[e]));return t};function v(t,e,n,r){window.spiff={cart:{},products:{},transactions:new Map};var o=[].slice.call(document.querySelectorAll(".spiff-add-to-cart")).map((function(e){return function(t,e,n,r){return y(this,void 0,void 0,(function(){var o,i,a,s;return g(this,(function(c){switch(c.label){case 0:return n?[4,w(t,r)]:[3,2];case 1:if(!c.sent())return[2];c.label=2;case 2:return(o=document.createElement("button")).innerHTML="Customise now on #spiff",o.style.backgroundColor="#D61B5C",o.style.color="#fff",o.style.border="None",o.style.padding="10px 20px",o.style.fontSize="14px",o.style.width="100%",o.addEventListener("click",(function(n){return n.preventDefault(),n.stopPropagation(),e(t),!1})),(i=t.getAttribute("data-background-colour"))&&(o.style.backgroundColor=i),(a=t.getAttribute("data-label-colour"))&&(o.style.color=a),(s=t.getAttribute("data-label"))&&(o.innerHTML=s),t.appendChild(o),[2]}}))}))}(e,(function(e){return t(e)}),n,r)})),i=[].slice.call(document.querySelectorAll("[data-spiff-personalise-button]")).map((function(e){return function(t,e,n,r,o){return y(this,void 0,void 0,(function(){return g(this,(function(e){switch(e.label){case 0:return r?[4,w(t,o)]:[3,2];case 1:if(!e.sent())return[2];e.label=2;case 2:return t.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),n(t),!1})),[2]}}))}))}(e,0,(function(e){return t(e)}),n,r)}));Promise.all(b(o,i)).then((function(){document.querySelectorAll("[data-spiff-hide]").forEach((function(t){var e=t.getAttribute("data-product-id");e&&window.spiff.products[e]&&(t.style.display="none")}))}))}function w(t,e){return y(this,void 0,void 0,(function(){var n,r,o,i,a,s,c,u,l;return g(this,(function(d){switch(d.label){case 0:return(n=e)?[4,e(t)]:[3,2];case 1:n=d.sent(),d.label=2;case 2:return n?[2,!0]:(r=t.getAttribute("data-external-integration-id"))&&(o=t.getAttribute("data-product-id"))?(i=r.replace(/\//g,"_"),a=S.API+"/api/integrationproducts/"+i+"/"+o,[4,fetch(a)]):[2,!1];case 3:return 200!==(s=d.sent()).status?[2,!1]:[4,s.json()];case 4:return(c=d.sent()).data.enabled&&c.data.integrationEnabled?(u=c.links.find((function(t){return"transaction"===t.rel})),l=u?u.href:"",window.spiff.products[o]=!0,t.setAttribute("data-transaction-link",l),[2,!0]):[2,!1]}}))}))}var I=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},x=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},P=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},k=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(P(arguments[e]));return t},E=function(){function t(t){this.options=t,this.callbacks=[],this.isLoading=!1}return t.prototype.on=function(t,e){var n=e.bind(this);if("complete"!==t&&"quit"!==t)throw new Error("Invalid Hosted Experience callback event name: "+t+".");this.callbacks.push({eventName:t,callback:function(t){n(t),window.Spiff._hostedExperienceExecuting=!1}})},t.prototype.execute=function(t){var e,n,r,o,i=this;if(!window.Spiff._hostedExperienceExecuting){var a,s;if(window.Spiff._hostedExperienceExecuting=!0,this.loadBoxFrame=function(t){var e,n=document.createElement("div"),r=(null==t?void 0:t.forceFullScreen)||window.innerWidth<=1366?0:50;if(n.className="create-load-frame",(null==t?void 0:t.fadeOutTimeMs)&&(n.style.opacity="1",n.style.transition="opacity "+t.fadeOutTimeMs+"ms ease-in-out"),null==t?void 0:t.loadingImage){if((e=document.createElement("img")).setAttribute("src",t.loadingImage),e.setAttribute("alt","Loading image"),t.imageStyles){var o=document.createElement("style");o.innerHTML=".create-load-frame img { "+t.imageStyles+" }",n.appendChild(o)}}else(e=document.createElementNS("http://www.w3.org/2000/svg","svg")).innerHTML='<style>.spinner_nOfF{animation:spinner_qtyZ 2s cubic-bezier(0.36,.6,.31,1) infinite}.spinner_fVhf{animation-delay:-.5s}.spinner_piVe{animation-delay:-1s}.spinner_MSNs{animation-delay:-1.5s}@keyframes spinner_qtyZ{0%{r:0}25%{r:3px;cx:4px}50%{r:3px;cx:12px}75%{r:3px;cx:20px}100%{r:0;cx:20px}}</style><circle class="spinner_nOfF" cx="4" cy="12" r="3"/><circle class="spinner_nOfF spinner_fVhf" cx="4" cy="12" r="3"/><circle class="spinner_nOfF spinner_piVe" cx="4" cy="12" r="3"/><circle class="spinner_nOfF spinner_MSNs" cx="4" cy="12" r="3"/>',e.setAttribute("height","150"),e.setAttribute("width","150"),e.setAttribute("viewBox","0 0 24 24");return e.style.left="0px",e.style.top="0px",e.style.right="0px",e.style.bottom="0px",e.style.margin="auto",(null==t?void 0:t.embedElement)?(n.style.background=(null==t?void 0:t.background)||"#fff",n.style.border="0",n.style.width="100%",n.style.height="100%",e.style.position="relative",e.style.display="flex"):(n.style.overflow="hidden",n.style.position="fixed",n.style.zIndex="16777273",n.style.background=(null==t?void 0:t.background)||"#fff",n.style.border=r>0?"1px solid #ccc":"0",n.style.width="calc(100% - "+2*r+"px)",n.style.height="calc(100% - "+2*r+"px)",n.style.top=r.toString()+"px",n.style.left=r.toString()+"px",e.style.position="absolute"),n.appendChild(e),n}({background:null===(e=this.options.loadingOptions)||void 0===e?void 0:e.background,embedElement:this.options.embedElement,fadeOutTimeMs:null===(n=this.options.loadingOptions)||void 0===n?void 0:n.fadeOutTimeMs,forceFullScreen:this.options.forceFullscreen,imageStyles:null===(r=this.options.loadingOptions)||void 0===r?void 0:r.imageStyles,loadingImage:null===(o=this.options.loadingOptions)||void 0===o?void 0:o.image}),this.lightBox=(null==t?void 0:t.backdrop)?(a=null==t?void 0:t.backdrop,(s=document.createElement("div")).className="spiff-commerce-lightbox",s.style.overflow="hidden",s.style.position="fixed",s.style.zIndex="16777271",s.style.backgroundColor=a.color,s.style.opacity=a.opacity.toString(),s.style.width="100%",s.style.height="100%",s.style.top="0px",s.style.left="0px",s.style.display="block",s):void 0,this.options.embedElement)this.options.embedElement.appendChild(this.loadBoxFrame);else{document.body.appendChild(this.loadBoxFrame),this.lightBox&&document.body.appendChild(this.lightBox);var c=window.scrollY;document.body.style.position="fixed",document.body.style.top="-"+c+"px"}return new Promise((function(e,n){return I(i,void 0,void 0,(function(){var r,o,i,a,s,c,u,l,d,p,f,h=this;return x(this,(function(y){switch(y.label){case 0:if(y.trys.push([0,4,,5]),this.experienceCreated)throw new Error("Hosted Experience already created. To open a new workflow, create a new Hosted Experience.");if(this.isLoading)throw new Error("Hosted Experience in progress. Wait for promise to resolve.");return this.isLoading=!0,this.resolveLoading=e,this.experienceCreated=!0,r=[],o=this.options.embedElement?"embed=true":"",i=this.options.presentmentCurrency&&"null"!==this.options.presentmentCurrency?"currencyCode="+this.options.presentmentCurrency:"",r.push(o,i),a="",this.options.portalMode?a="/":this.options.transactionId||this.options.bundleId?a="/"+(this.options.transactionId||this.options.bundleId):(s=t&&t.workflowId?"workflowId="+t.workflowId:"",r.push(s),a="/new"),this.options.applicationKey&&r.push("applicationKey="+this.options.applicationKey),this.options.portalMode?[3,3]:this.options.bundleMode?[3,1]:(this.options.product&&r.push.apply(r,k(this.options.product.getExperienceQueryParams())),[3,3]);case 1:return this.options.productCollectionId&&r.push("productCollectionId="+this.options.productCollectionId),this.options.bundleId&&r.push("bundleId="+this.options.bundleId),this.options.kioskMode&&r.push("kiosk="+this.options.kioskMode),this.options.initialBundleMetadata&&(c=encodeURIComponent(JSON.stringify(this.options.initialBundleMetadata)),r.push("initialBundleMetadata="+c)),this.options.product?[4,this.options.product.getIntegrationProduct()]:[3,3];case 2:u=y.sent(),r.push("integrationProductId="+u.id),y.label=3;case 3:return this.options.finishButtonText&&""!==this.options.finishButtonText&&r.push("finishButtonText="+encodeURIComponent(this.options.finishButtonText)),l=r.filter((function(t){return""!==t})).join("&"),d=""+(this.options.portalMode?S.PORTAL_URL:this.options.bundleMode?S.BUNDLE_URL:S.EXPERIENCE_URL)+a+"?"+l,this.iframe=(g=this.options.embedElement,m=this.options.forceFullscreen,b=document.createElement("iframe"),v=m||window.innerWidth<=1366?0:50,b.className="test-create-design-iframe",b.setAttribute("data-hj-allow-iframe","true"),b.setAttribute("allow","clipboard-read; clipboard-write"),g?(b.style.border="0",b.style.width="100%",b.style.height="100%"):(b.scrolling="no",b.style.overflow="hidden",b.style.position="fixed",b.style.zIndex="16777272",b.style.backgroundColor="#fff",b.style.border=v>0?"1px solid #ccc":"0",b.style.width="calc(100% - "+2*v+"px)",b.style.height="calc(100% - "+2*v+"px)",b.style.top=v.toString()+"px",b.style.left=v.toString()+"px"),b),this.iframe.style.display="none",this.iframe.onload=function(){h.iframe.style.display="block"},this.options.embedElement?this.options.embedElement.insertBefore(this.iframe,this.loadBoxFrame):(document.body.insertBefore(this.iframe,this.loadBoxFrame),p=window.scrollY,document.body.style.position="fixed",document.body.style.top="-"+p+"px"),this.listener=this.iterateOverCallbacks.bind(this),window.addEventListener("message",this.listener),this.iframe.src=d,[3,5];case 4:return f=y.sent(),n(f),[3,5];case 5:return[2]}var g,m,b,v}))}))}))}console.error("A SpiffCommerce Hosted Experience already executing.")},t.prototype.iterateOverCallbacks=function(t){var e,n,r=this,o=t.data.event;if("onLoad"!==o&&"onError"!==o){if("onCancel"===o||"onComplete"===o){if("onCancel"===o)this.callbacks.forEach((function(t){"quit"===t.eventName&&t.callback(null)}));else if("onComplete"===o){var i=t.data.bundleId?this.callbackOptionsForBundleComplete(t.data):this.callbackOptionsForTransactionComplete(t.data);this.callbacks.forEach((function(t){"complete"===t.eventName&&t.callback(i)}))}if(window.removeEventListener("message",this.listener),this.options.embedElement||(document.body.removeChild(this.iframe),this.lightBox&&document.body.removeChild(this.lightBox)),document.body.style.overflow="inherit",!this.options.embedElement){var a=document.body.style.top;document.body.style.position="",document.body.style.top="",window.scrollTo(0,-1*parseInt(a||"0"))}}}else{if(!this.isLoading)return;if(this.isLoading=!1,this.resolveLoading&&this.resolveLoading(),!this.iframe||!this.loadBoxFrame)return;(null===(e=this.options.loadingOptions)||void 0===e?void 0:e.fadeOutTimeMs)?(this.loadBoxFrame.style.opacity="0",setTimeout((function(){r.loadBoxFrame.remove()}),(null===(n=this.options.loadingOptions)||void 0===n?void 0:n.fadeOutTimeMs)+10)):this.loadBoxFrame.remove()}},t.prototype.callbackOptionsForTransactionComplete=function(t){return{additionalExternalProductId:t.additionalExternalProductId||void 0,additionalExternalVariantId:t.additionalExternalVariantId||void 0,designExternalVariants:t.designExternalVariants,designProductId:t.designProductId||void 0,designProductVariantId:t.designProductVariantId||void 0,externalCartProductId:t.externalCartProductId||void 0,externalCartProductVariantId:t.externalCartProductVariantId||void 0,baseCost:t.baseCost,designMetaData:{metadata:t.metadata||void 0,selectedVariants:t.selectedVariants||void 0},exportedData:t.exportedData||{},optionsCost:t.optionsCost,previewImage:t.lineItemImageUrl||void 0,processExecutionId:t.processExecutionId,sku:t.sku,transactionId:t.transactionId,workflowViewerLink:t.workflowViewerLink,quantity:t.quantity||1,type:"transaction"}},t.prototype.callbackOptionsForBundleComplete=function(t){var e=this;return{bundleId:t.bundleId,items:t.items.map((function(t){return e.callbackOptionsForTransactionComplete(t)})),type:"bundle"}},t}(),C=function(){function t(t,e){this.hostedExperience=new E(t)}return t.prototype.on=function(t,e){return this.hostedExperience.on(t,e)},t.prototype.execute=function(t){return this.hostedExperience.execute(t)},t}(),S={API:"https://api.spiff.com.au",ENV:"production",PORTAL_URL:"https://app.spiff.com.au/#/portal",EXPERIENCE_URL:"https://app.spiff.com.au/#/experience",BUNDLE_URL:"https://app.spiff.com.au/#/bundle"},T={IntegrationProduct:p,Product:h,Transaction:C,HostedExperience:E,Analytics:{createPageSession:function(){return console.warn("SpiffApi.Analytics.createPageSession is deprecated."),"undefined"}},ServerAPI:S.API,getRegion:function(){return"au"},setRegion:function(t){var e=t.toLowerCase();if("au"!==e){T.getRegion=function(){return e};var n="ap"===e?"au":e;S.API=S.API.replace("api.spiff.com.au","api."+n+".spiffcommerce.com"),T.ServerAPI=S.API,S.PORTAL_URL=S.PORTAL_URL.replace("app.spiff.com.au","app."+n+".spiffcommerce.com"),S.EXPERIENCE_URL=S.EXPERIENCE_URL.replace("app.spiff.com.au","app."+n+".spiffcommerce.com"),S.BUNDLE_URL=S.BUNDLE_URL.replace("app.spiff.com.au","app."+n+".spiffcommerce.com")}}},O=function(){return(O=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},R=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},A=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};var F=function(){return(F=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},L=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},_=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};(new function(){var t=this;this.createCustomiseButtons=function(){try{v((function(e){return t.doWorkflow(e)}),t.pageSessionId,!0,t.shouldPersonaliseProductFromTag)}catch(t){console.log(t)}},this.externalIdsForRedirectProduct=function(){return L(t,void 0,void 0,(function(){var t,e,n,r,o;return _(this,(function(i){switch(i.label){case 0:return(t=window.location.href).includes("/products/")?(e=this.getHandleFromUrl(t),[4,this.getShopifyProduct(e)]):[2,null];case 1:return n=i.sent(),(r=this.getRedirectProductFromTags(n.tags))?[4,this.getShopifyProduct(r)]:[2,null];case 2:return o=i.sent(),[2,{externalIntegrationId:window.Shopify.shop,externalProductId:o.id,callbackUrl:window.location.href}]}}))}))},this.doWorkflow=function(e){var n=function(t){return t.getAttribute("data-presentment-currency")}(e);!function(t,e,n,r){R(this,void 0,void 0,(function(){var o,i,a=this;return A(this,(function(s){switch(s.label){case 0:return[4,R(a,void 0,void 0,(function(){var n;return A(this,(function(r){switch(r.label){case 0:return[4,e()];case 1:return(n=r.sent())?[2,new h({integrationId:n.externalIntegrationId,productId:n.externalProductId})]:[2,new h({integrationId:t.getAttribute("data-external-integration-id"),productId:t.getAttribute("data-product-id")})]}}))}))];case 1:return[4,(o=s.sent()).confirmActive()];case 2:return s.sent(),(i=new E({presentmentCurrency:r,product:o})).on("complete",(function(t){if("transaction"===t.type){var e=O({previewImage:t.previewImage},t.designMetaData.metadata);n(t.transactionId,e)}})),i.execute(),[2]}}))}))}(e,t.externalIdsForRedirectProduct,(function(n,r){return t.completeWorkflow(e,n,r)}),n)},this.completeWorkflow=function(e,n,r){return L(t,void 0,void 0,(function(){var t,o,i,a,s,c,u;return _(this,(function(l){switch(l.label){case 0:return(t=location.href).includes("/products/")?(o=this.getHandleFromUrl(t),[4,this.getShopifyProduct(o)]):[3,8];case 1:return i=l.sent(),(a=this.dataForShopifyTag("spiff-personalisable-product-handle",i.tags))?[4,this.addItemToCart(a,n)]:[3,4];case 2:return l.sent(),[4,this.addItemToCart(o)];case 3:return l.sent(),window.top.location.href="/cart",[2];case 4:return(s=this.dataForShopifyTag("spiff-only-product-handle",i.tags))?[4,this.addItemToCart(s,n)]:[3,6];case 5:return l.sent(),window.top.location.href="/cart",[2];case 6:return(c=this.dataForShopifyTag("spiff-no-redirect-product-handle",i.tags))?[4,this.addItemToCart(c,n)]:[3,8];case 7:return l.sent(),[2];case 8:if(!(u=e.getAttribute("data-product-handle")))throw new Error("Missing product handle.");return[4,this.addItemToCart(u,n,r)];case 9:return l.sent(),window.top.location.href="/cart",[2]}}))}))},this.addItemToCart=function(e,n,r){return L(t,void 0,void 0,(function(){var t,o,i,a;return _(this,(function(s){switch(s.label){case 0:return t=F({spiffTransactionId:n},r),[4,this.getShopifyProduct(e)];case 1:return o=s.sent(),i=o.variants[0].id,a=JSON.stringify({quantity:1,id:i,properties:t}),[4,fetch("/cart/add.js",{method:"POST",body:a,headers:{"Content-Type":"application/json"}})];case 2:return s.sent(),[2]}}))}))},this.getHandleFromUrl=function(t){var e=t.split("?")[0].split("/"),n=e.slice(3,e.length).filter((function(t){return""!==t}));return n[n.length-1]},this.shouldPersonaliseProductFromTag=function(e){return L(t,void 0,void 0,(function(){var t,n,r,o,i,a,s,c,u,l,d,p;return _(this,(function(f){switch(f.label){case 0:return(t=location.href).includes("/products/")?(n=this.getHandleFromUrl(t),[4,this.getShopifyProduct(n)]):[3,5];case 1:return r=f.sent(),(o=this.getRedirectProductFromTags(r.tags))?[4,this.getShopifyProduct(o)]:[2,!1];case 2:return i=f.sent(),a=i.id,s=window.Shopify.shop,c=S.API+"/api/integrationproducts/"+s+"/"+a,[4,fetch(c)];case 3:return 200!==(u=f.sent()).status?[2,!1]:[4,u.json()];case 4:return(l=f.sent()).data.enabled&&l.data.integrationEnabled?(d=l.links.find((function(t){return"transaction"===t.rel})),p=d?d.href:"",window.spiff.products[a]=!0,e.setAttribute("data-transaction-link",p),[2,!0]):[2,!1];case 5:return[2]}}))}))},this.getRedirectProductFromTags=function(e){var n=t.dataForShopifyTag("spiff-personalisable-product-handle",e);if(n)return n;var r=t.dataForShopifyTag("spiff-only-product-handle",e);if(r)return r;var o=t.dataForShopifyTag("spiff-no-redirect-product-handle",e);return o||null},this.dataForShopifyTag=function(t,e){var n=e.split(", ").find((function(e){var n=e.match(t);return!!n&&n.length>0}));return n?n.substr(t.length+1,n.length):""},this.getShopifyProduct=function(e){return L(t,void 0,void 0,(function(){return _(this,(function(t){switch(t.label){case 0:return[4,fetch("/products/"+e+".json")];case 1:return[4,t.sent().json()];case 2:return[2,t.sent().product]}}))}))}}).createCustomiseButtons(),window.Spiff||(window.Spiff=T,window.dispatchEvent(new Event("SpiffApiReady")))}]);